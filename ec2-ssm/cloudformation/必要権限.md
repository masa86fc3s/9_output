必要な権限はすでに揃っている

- EC2 作成 → ec2:RunInstances
- EC2 情報取得 → ec2:Describe*
- IAM ロール付与 → iam:PassRole
- CloudFormation 操作 → cloudformation:*Stack*
→ これだけで CloudFormation デプロイは通る

####　ここで重要なのがiam:PassRole
* AWS の IAM で あるユーザーやサービスが IAM ロールを「他の AWS リソースに渡す（付与する）」ことを許可する権限 のことです
  * これがあればフルアクセスにしなくても起動するようになる


---
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "CloudFormationStackManagement",
      "Effect": "Allow",
      "Action": [
        "cloudformation:CreateStack",
        "cloudformation:UpdateStack",
        "cloudformation:DescribeStacks",
        "cloudformation:DeleteStack"
      ],
      "Resource": "*",
      "Description": "CloudFormation スタックを作成、更新、確認、削除するための権限。CloudFormation を使って EC2 と IAM ロールをデプロイするために必要。"
    },
    {
      "Sid": "EC2InstanceManagement",
      "Effect": "Allow",
      "Action": [
        "ec2:RunInstances",
        "ec2:TerminateInstances",
        "ec2:Describe*",
        "ec2:CreateSecurityGroup",
        "ec2:AuthorizeSecurityGroupIngress",
        "ec2:AuthorizeSecurityGroupEgress",
        "ec2:RevokeSecurityGroupIngress",
        "ec2:RevokeSecurityGroupEgress",
        "ec2:CreateTags",
        "ec2:CreateKeyPair",
        "ec2:DeleteKeyPair"
      ],
      "Resource": "*",
      "Description": "EC2 インスタンスの作成、終了、情報取得、タグ付け、セキュリティグループやキーペアの作成・設定など、インスタンスデプロイに必要な操作を許可。"
    },
    {
      "Sid": "IAMRolePass",
      "Effect": "Allow",
      "Action": [
        "iam:PassRole",
        "iam:GetRole"
      ],
      "Resource": "arn:aws:iam::216989098479:role/SessionManagerEC2Role",
      "Description": "EC2 に IAM ロールを付与するために必要な権限。特定の固定ロール SessionManagerEC2Role のみ許可。"
    }
  ]
}
